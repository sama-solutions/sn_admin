<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template: Page d'accueil -->
    <template id="organigramme_index" name="Organigramme - Accueil">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <!-- Hero Section -->
                    <div class="text-center mb-5">
                        <h1 class="display-4" style="color: #00853F;">Organigramme de l'Administration Sénégalaise</h1>
                        <p class="lead">Trouvez rapidement vos interlocuteurs dans l'administration publique</p>
                    </div>

                    <!-- Barre de recherche -->
                    <div class="row justify-content-center mb-5">
                        <div class="col-md-8">
                            <form action="/organigramme/search" method="get" class="input-group input-group-lg">
                                <input type="text" name="q" class="form-control" placeholder="Rechercher un agent, une fonction, un service..." required="required"/>
                                <button type="submit" class="btn btn-success">
                                    <i class="fa fa-search"/> Rechercher
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Statistiques -->
                    <div class="row text-center mb-5">
                        <div class="col-md-3">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h2 class="text-primary"><t t-esc="total_ministries"/></h2>
                                    <p class="mb-0">Ministères</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-info">
                                <div class="card-body">
                                    <h2 class="text-info"><t t-esc="total_directions"/></h2>
                                    <p class="mb-0">Directions</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h2 class="text-success"><t t-esc="total_services"/></h2>
                                    <p class="mb-0">Services</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-warning">
                                <div class="card-body">
                                    <h2 class="text-warning"><t t-esc="total_agents"/></h2>
                                    <p class="mb-0">Agents</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cartes cliquables -->
                    <div class="row">
                        <t t-if="presidency">
                            <div class="col-md-4 mb-4">
                                <a t-attf-href="/organigramme/ministere/#{presidency[0].id}" class="text-decoration-none">
                                    <div class="card h-100 border-danger">
                                        <div class="card-body text-center">
                                            <i class="fa fa-university fa-3x text-danger mb-3"/>
                                            <h4 class="card-title">Présidence</h4>
                                            <p class="card-text"><t t-esc="presidency[0].direction_count"/> Directions</p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </t>
                        <t t-if="primature">
                            <div class="col-md-4 mb-4">
                                <a t-attf-href="/organigramme/ministere/#{primature[0].id}" class="text-decoration-none">
                                    <div class="card h-100 border-primary">
                                        <div class="card-body text-center">
                                            <i class="fa fa-building fa-3x text-primary mb-3"/>
                                            <h4 class="card-title">Primature</h4>
                                            <p class="card-text"><t t-esc="primature[0].direction_count"/> Directions</p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </t>
                        <div class="col-md-4 mb-4">
                            <a href="/organigramme/ministeres" class="text-decoration-none">
                                <div class="card h-100 border-success">
                                    <div class="card-body text-center">
                                        <i class="fa fa-sitemap fa-3x text-success mb-3"/>
                                        <h4 class="card-title">Ministères</h4>
                                        <p class="card-text"><t t-esc="len(ministries)"/> Ministères</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Liste des ministères -->
    <template id="organigramme_ministries" name="Liste des Ministères">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item active">Ministères</li>
                        </ol>
                    </nav>

                    <h1 class="mb-4" style="color: #00853F;">Ministères et Institutions</h1>

                    <div class="row">
                        <t t-foreach="ministries" t-as="ministry">
                            <div class="col-md-4 mb-4">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h5 class="card-title"><t t-esc="ministry.name"/></h5>
                                        <p class="card-text">
                                            <strong>Code:</strong> <t t-esc="ministry.code"/><br/>
                                            <t t-if="ministry.phone"><strong>Tél:</strong> <t t-esc="ministry.phone"/><br/></t>
                                            <t t-if="ministry.email"><strong>Email:</strong> <t t-esc="ministry.email"/><br/></t>
                                            <strong>Directions:</strong> <t t-esc="ministry.direction_count"/>
                                        </p>
                                        <a t-attf-href="/organigramme/ministere/#{ministry.id}" class="btn btn-success btn-sm">Voir détails</a>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Détails d'un ministère -->
    <template id="organigramme_ministry_detail" name="Détails Ministère">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item"><a href="/organigramme/ministeres">Ministères</a></li>
                            <li class="breadcrumb-item active"><t t-esc="ministry.name"/></li>
                        </ol>
                    </nav>

                    <h1 class="mb-4" style="color: #00853F;"><t t-esc="ministry.name"/></h1>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <p><strong>Code:</strong> <t t-esc="ministry.code"/></p>
                            <p><strong>Type:</strong> <t t-esc="dict(ministry._fields['type'].selection).get(ministry.type)"/></p>
                            <t t-if="ministry.address"><p><strong>Adresse:</strong> <t t-esc="ministry.address"/></p></t>
                        </div>
                        <div class="col-md-6">
                            <t t-if="ministry.phone"><p><strong>Téléphone:</strong> <t t-esc="ministry.phone"/></p></t>
                            <t t-if="ministry.email"><p><strong>Email:</strong> <t t-esc="ministry.email"/></p></t>
                            <t t-if="ministry.website"><p><strong>Site Web:</strong> <a t-att-href="ministry.website" target="_blank"><t t-esc="ministry.website"/></a></p></t>
                        </div>
                    </div>

                    <t t-if="ministry.description">
                        <h3>Description</h3>
                        <p><t t-esc="ministry.description"/></p>
                    </t>

                    <!-- Affichage par catégories si elles existent -->
                    <t t-if="categories">
                        <h3 class="mt-4">Structure Organisationnelle</h3>
                        <t t-foreach="categories" t-as="category">
                            <div class="card mb-3">
                                <div class="card-header bg-primary text-white">
                                    <h4 class="mb-0">
                                        <a t-attf-href="/organigramme/categorie/#{category.id}" class="text-white text-decoration-none">
                                            <i class="fa fa-folder-open"/> <t t-esc="category.name"/>
                                            <span class="badge bg-light text-dark ms-2"><t t-esc="category.direction_count"/> directions</span>
                                        </a>
                                    </h4>
                                </div>
                                <div class="card-body">
                                    <div class="list-group">
                                        <t t-foreach="category.direction_ids.filtered(lambda d: d.active and d.state == 'active')" t-as="direction">
                                            <a t-attf-href="/organigramme/direction/#{direction.id}" class="list-group-item list-group-item-action">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h5 class="mb-1"><t t-esc="direction.name"/></h5>
                                                    <small><t t-esc="direction.service_count"/> services</small>
                                                </div>
                                                <p class="mb-1"><t t-esc="direction.code"/> - <t t-esc="dict(direction._fields['type'].selection).get(direction.type)"/></p>
                                            </a>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>

                    <!-- Directions sans catégorie -->
                    <t t-set="directions_without_category" t-value="directions.filtered(lambda d: not d.category_id)"/>
                    <t t-if="directions_without_category">
                        <h3 class="mt-4">Directions (<t t-esc="len(directions_without_category)"/>)</h3>
                        <div class="list-group">
                            <t t-foreach="directions_without_category" t-as="direction">
                                <a t-attf-href="/organigramme/direction/#{direction.id}" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1"><t t-esc="direction.name"/></h5>
                                        <small><t t-esc="direction.service_count"/> services</small>
                                    </div>
                                    <p class="mb-1"><t t-esc="direction.code"/> - <t t-esc="dict(direction._fields['type'].selection).get(direction.type)"/></p>
                                </a>
                            </t>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Détails d'une direction -->
    <template id="organigramme_direction_detail" name="Détails Direction">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item"><a href="/organigramme/ministeres">Ministères</a></li>
                            <li class="breadcrumb-item"><a t-attf-href="/organigramme/ministere/#{direction.ministry_id.id}"><t t-esc="direction.ministry_id.name"/></a></li>
                            <t t-if="direction.category_id">
                                <li class="breadcrumb-item"><a t-attf-href="/organigramme/categorie/#{direction.category_id.id}"><t t-esc="direction.category_id.name"/></a></li>
                            </t>
                            <li class="breadcrumb-item active"><t t-esc="direction.name"/></li>
                        </ol>
                    </nav>

                    <h1 class="mb-4" style="color: #00853F;"><t t-esc="direction.name"/></h1>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <p><strong>Code:</strong> <t t-esc="direction.code"/></p>
                            <p><strong>Type:</strong> <t t-esc="dict(direction._fields['type'].selection).get(direction.type)"/></p>
                            <p><strong>Ministère:</strong> <t t-esc="direction.ministry_id.name"/></p>
                        </div>
                        <div class="col-md-6">
                            <t t-if="direction.phone"><p><strong>Téléphone:</strong> <t t-esc="direction.phone"/></p></t>
                            <t t-if="direction.email"><p><strong>Email:</strong> <t t-esc="direction.email"/></p></t>
                            <t t-if="direction.manager_id"><p><strong>Responsable:</strong> <t t-esc="direction.manager_id.name"/></p></t>
                        </div>
                    </div>

                    <h3 class="mt-4">Services (<t t-esc="len(services)"/>)</h3>
                    <div class="list-group">
                        <t t-foreach="services" t-as="service">
                            <a t-attf-href="/organigramme/service/#{service.id}" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1"><t t-esc="service.name"/></h5>
                                    <small><t t-esc="service.agent_count"/> agents</small>
                                </div>
                                <p class="mb-1"><t t-esc="service.code"/> - <t t-esc="dict(service._fields['type'].selection).get(service.type)"/></p>
                            </a>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Détails d'un service -->
    <template id="organigramme_service_detail" name="Détails Service">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item"><a href="/organigramme/ministeres">Ministères</a></li>
                            <li class="breadcrumb-item"><a t-attf-href="/organigramme/ministere/#{service.ministry_id.id}"><t t-esc="service.ministry_id.name"/></a></li>
                            <t t-if="service.direction_id.category_id">
                                <li class="breadcrumb-item"><a t-attf-href="/organigramme/categorie/#{service.direction_id.category_id.id}"><t t-esc="service.direction_id.category_id.name"/></a></li>
                            </t>
                            <li class="breadcrumb-item"><a t-attf-href="/organigramme/direction/#{service.direction_id.id}"><t t-esc="service.direction_id.name"/></a></li>
                            <li class="breadcrumb-item active"><t t-esc="service.name"/></li>
                        </ol>
                    </nav>

                    <h1 class="mb-4" style="color: #00853F;"><t t-esc="service.name"/></h1>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <p><strong>Code:</strong> <t t-esc="service.code"/></p>
                            <p><strong>Type:</strong> <t t-esc="dict(service._fields['type'].selection).get(service.type)"/></p>
                            <p><strong>Direction:</strong> <t t-esc="service.direction_id.name"/></p>
                        </div>
                        <div class="col-md-6">
                            <t t-if="service.phone"><p><strong>Téléphone:</strong> <t t-esc="service.phone"/></p></t>
                            <t t-if="service.email"><p><strong>Email:</strong> <t t-esc="service.email"/></p></t>
                            <t t-if="service.manager_id"><p><strong>Responsable:</strong> <t t-esc="service.manager_id.name"/></p></t>
                        </div>
                    </div>

                    <h3 class="mt-4">Agents (<t t-esc="len(agents)"/>)</h3>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Fonction</th>
                                <th>Téléphone</th>
                                <th>Email</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="agents" t-as="agent">
                                <tr>
                                    <td><a t-attf-href="/organigramme/agent/#{agent.id}"><t t-esc="agent.name"/></a></td>
                                    <td><t t-esc="agent.function"/></td>
                                    <td><t t-esc="agent.work_phone or agent.mobile_phone or ''"/></td>
                                    <td><t t-esc="agent.work_email or ''"/></td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Détails d'un agent -->
    <template id="organigramme_agent_detail" name="Détails Agent">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item"><a href="/organigramme/ministeres">Ministères</a></li>
                            <li class="breadcrumb-item"><a t-attf-href="/organigramme/ministere/#{agent.ministry_id.id}"><t t-esc="agent.ministry_id.name"/></a></li>
                            <t t-if="agent.direction_id.category_id">
                                <li class="breadcrumb-item"><a t-attf-href="/organigramme/categorie/#{agent.direction_id.category_id.id}"><t t-esc="agent.direction_id.category_id.name"/></a></li>
                            </t>
                            <li class="breadcrumb-item"><a t-attf-href="/organigramme/direction/#{agent.direction_id.id}"><t t-esc="agent.direction_id.name"/></a></li>
                            <li class="breadcrumb-item"><a t-attf-href="/organigramme/service/#{agent.service_id.id}"><t t-esc="agent.service_id.name"/></a></li>
                            <li class="breadcrumb-item active"><t t-esc="agent.name"/></li>
                        </ol>
                    </nav>

                    <div class="row">
                        <div class="col-md-8">
                            <h1 class="mb-4" style="color: #00853F;"><t t-esc="agent.name"/></h1>

                            <p><strong>Fonction:</strong> <t t-esc="agent.function"/></p>
                            <p><strong>Service:</strong> <t t-esc="agent.service_id.name"/></p>
                            <p><strong>Direction:</strong> <t t-esc="agent.direction_id.name"/></p>
                            <p><strong>Ministère:</strong> <t t-esc="agent.ministry_id.name"/></p>

                            <t t-if="show_phone">
                                <t t-if="agent.work_phone"><p><strong>Téléphone Bureau:</strong> <t t-esc="agent.work_phone"/></p></t>
                                <t t-if="agent.mobile_phone"><p><strong>Téléphone Mobile:</strong> <t t-esc="agent.mobile_phone"/></p></t>
                            </t>

                            <t t-if="show_email">
                                <t t-if="agent.work_email"><p><strong>Email:</strong> <a t-attf-href="mailto:#{agent.work_email}"><t t-esc="agent.work_email"/></a></p></t>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Recherche -->
    <template id="organigramme_search" name="Recherche">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item active">Recherche</li>
                        </ol>
                    </nav>

                    <h1 class="mb-4" style="color: #00853F;">Recherche d'interlocuteur</h1>

                    <!-- Formulaire de recherche -->
                    <form action="/organigramme/search" method="get" class="mb-4">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <input type="text" name="q" class="form-control" placeholder="Nom, fonction, email..." t-att-value="query"/>
                            </div>
                            <div class="col-md-6 mb-3">
                                <select name="ministry_id" class="form-control">
                                    <option value="">-- Tous les ministères --</option>
                                    <t t-foreach="ministries" t-as="m">
                                        <option t-att-value="m.id" t-att-selected="'selected' if ministry_id and int(ministry_id) == m.id else None">
                                            <t t-esc="m.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success"><i class="fa fa-search"/> Rechercher</button>
                    </form>

                    <!-- Résultats -->
                    <t t-if="query or ministry_id">
                        <h3>Résultats (<t t-esc="total_count"/>)</h3>

                        <t t-if="agents">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Fonction</th>
                                        <th>Service</th>
                                        <th>Ministère</th>
                                        <th>Contact</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="agents" t-as="agent">
                                        <tr>
                                            <td><a t-attf-href="/organigramme/agent/#{agent.id}"><t t-esc="agent.name"/></a></td>
                                            <td><t t-esc="agent.function"/></td>
                                            <td><t t-esc="agent.service_id.name"/></td>
                                            <td><t t-esc="agent.ministry_id.name"/></td>
                                            <td>
                                                <t t-if="agent.work_phone"><t t-esc="agent.work_phone"/><br/></t>
                                                <t t-if="agent.work_email"><t t-esc="agent.work_email"/></t>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <!-- Pagination -->
                            <t t-if="total_pages &gt; 1">
                                <nav>
                                    <ul class="pagination">
                                        <t t-foreach="range(1, total_pages + 1)" t-as="p">
                                            <li t-att-class="'page-item' + (' active' if p == page else '')">
                                                <a class="page-link" t-attf-href="/organigramme/search?q=#{query}&amp;ministry_id=#{ministry_id or ''}&amp;page=#{p}">
                                                    <t t-esc="p"/>
                                                </a>
                                            </li>
                                        </t>
                                    </ul>
                                </nav>
                            </t>
                        </t>
                        <t t-else="">
                            <p class="alert alert-info">Aucun résultat trouvé.</p>
                        </t>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Organigramme interactif public -->
    <template id="organigramme_tree" name="Organigramme Interactif">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item active">Organigramme</li>
                        </ol>
                    </nav>

                    <h1 class="mb-4" style="color: #00853F;">Organigramme interactif</h1>

                    <!-- Conteneur utilisé par sn_admin_public.js -->
                    <div id="orgchart-container" t-att-data-ministry-id="ministry_id" class="position-relative" style="min-height: 400px;"></div>
                </div>
            </div>
        </t>
    </template>

    <!-- Template: Détails d'une catégorie -->
    <template id="organigramme_category_detail" name="Détails Catégorie">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/organigramme">Accueil</a></li>
                            <li class="breadcrumb-item"><a href="/organigramme/ministeres">Ministères</a></li>
                            <li class="breadcrumb-item"><a t-attf-href="/organigramme/ministere/#{category.ministry_id.id}"><t t-esc="category.ministry_id.name"/></a></li>
                            <li class="breadcrumb-item active"><t t-esc="category.name"/></li>
                        </ol>
                    </nav>

                    <h1 class="mb-4" style="color: #00853F;">
                        <i class="fa fa-folder-open"/> <t t-esc="category.name"/>
                    </h1>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <p><strong>Code:</strong> <t t-esc="category.code or 'N/A'"/></p>
                            <p><strong>Ministère:</strong> <t t-esc="category.ministry_id.name"/></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Nombre de directions:</strong> <t t-esc="category.direction_count"/></p>
                            <p><strong>Nombre de services:</strong> <t t-esc="category.service_count"/></p>
                        </div>
                    </div>

                    <h3 class="mt-4">Directions (<t t-esc="len(directions)"/>)</h3>
                    <div class="list-group">
                        <t t-foreach="directions" t-as="direction">
                            <a t-attf-href="/organigramme/direction/#{direction.id}" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1"><t t-esc="direction.name"/></h5>
                                    <small><t t-esc="direction.service_count"/> services</small>
                                </div>
                                <p class="mb-1"><t t-esc="direction.code"/> - <t t-esc="dict(direction._fields['type'].selection).get(direction.type)"/></p>
                            </a>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

</odoo>
